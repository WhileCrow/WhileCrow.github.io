<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Animation - Crow&#039;s Sky</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Crow&#039;s Sky"><meta name="msapplication-TileImage" content="/img/avatarCircle.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Crow&#039;s Sky"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="Android动画分三种：View动画、帧动画、属性动画  是的， check， √ View动画View动画定义了渐变Alpha、旋转Rotate、缩放Scale、平移Translate四种基本动画，并且通过这四种基本动画的组合使用，可以实现多种交互效果。View动画使用非常简单，不仅可以通过XML文件来定义动画，同样可以通过Java代码来实现动画过程。 原理： 首先view的绘制是 drawB"><meta property="og:type" content="blog"><meta property="og:title" content="Animation"><meta property="og:url" content="http://example.com/2023/10/26/Animation/"><meta property="og:site_name" content="Crow&#039;s Sky"><meta property="og:description" content="Android动画分三种：View动画、帧动画、属性动画  是的， check， √ View动画View动画定义了渐变Alpha、旋转Rotate、缩放Scale、平移Translate四种基本动画，并且通过这四种基本动画的组合使用，可以实现多种交互效果。View动画使用非常简单，不仅可以通过XML文件来定义动画，同样可以通过Java代码来实现动画过程。 原理： 首先view的绘制是 drawB"><meta property="og:locale" content="en_US"><meta property="og:image" content="http://example.com/2023/10/26/Animation/image-20231027151841094.png"><meta property="og:image" content="http://example.com/2023/10/26/Animation/207f5681fbd42866692f260039ceaca8~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.awebp"><meta property="og:image" content="http://example.com/2023/10/26/Animation/8fafba2a2171db1efb63052a0370faed~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.awebp"><meta property="og:image" content="http://example.com/2023/10/26/Animation/613da23e462d2d04b9afa15d27029749~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.awebp"><meta property="og:image" content="http://example.com/2023/10/26/Animation/image-20231026114011752.png"><meta property="og:image" content="http://example.com/2023/10/26/Animation/17121317607bf110~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.awebp"><meta property="article:published_time" content="2023-10-26T03:34:39.000Z"><meta property="article:modified_time" content="2024-04-17T06:45:43.567Z"><meta property="article:author" content="White Crow"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/2023/10/26/Animation/image-20231027151841094.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com/2023/10/26/Animation/"},"headline":"Animation","image":["http://example.com/2023/10/26/Animation/image-20231027151841094.png","http://example.com/2023/10/26/Animation/image-20231026114011752.png"],"datePublished":"2023-10-26T03:34:39.000Z","dateModified":"2024-04-17T06:45:43.567Z","author":{"@type":"Person","name":"white crow"},"publisher":{"@type":"Organization","name":"Crow's Sky","logo":{"@type":"ImageObject","url":"http://example.com/img/avatarCircle.png"}},"description":"Android动画分三种：View动画、帧动画、属性动画  是的， check， √ View动画View动画定义了渐变Alpha、旋转Rotate、缩放Scale、平移Translate四种基本动画，并且通过这四种基本动画的组合使用，可以实现多种交互效果。View动画使用非常简单，不仅可以通过XML文件来定义动画，同样可以通过Java代码来实现动画过程。 原理： 首先view的绘制是 drawB"}</script><link rel="canonical" href="http://example.com/2023/10/26/Animation/"><link rel="icon" href="/img/avatarCircle.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/avatarCircle.png" alt="Crow&#039;s Sky" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/WhileCrow"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-10-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-10-26T03:34:39.000Z" title="10/26/2023, 11:34:39 AM">2023-10-26</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-04-17T06:45:43.567Z" title="4/17/2024, 2:45:43 PM">2024-04-17</time></span><span class="level-item"><a class="link-muted" href="/categories/Android/">Android</a></span><span class="level-item">25 minutes read (About 3729 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">Animation</h1><div class="content"><p>Android动画分三种：View动画、帧动画、属性动画</p>
<p><img src="/2023/10/26/Animation/image-20231027151841094.png" alt="image-20231027151841094"></p>
<p>是的， check， √</p>
<h2 id="View动画"><a href="#View动画" class="headerlink" title="View动画"></a>View动画</h2><p>View动画定义了渐变Alpha、旋转Rotate、缩放Scale、平移Translate四种基本动画，并且通过这四种基本动画的组合使用，可以实现多种交互效果。<br>View动画使用非常简单，不仅可以通过XML文件来定义动画，同样可以通过Java代码来实现动画过程。</p>
<p>原理：</p>
<p>首先view的绘制是 drawBackground() -&gt; onDraw() -&gt; dispatchDraw() -&gt; onDrawForeground() 的顺序，</p>
<p>//android/view/View.java中的boolean draw(Canvas canvas, ViewGroup parent, long drawingTime)方法</p>
<p>View.setAnimation会将旋转、缩放、平移等动画存下来，动画启动后通过invalidate() ，每一帧中在draw的时候通过canvas.translate、canvas.scale、cavas.setLayerAlpha等方式，执行动画。</p>
<p>故而view动画只会影响view的视觉效果，而不影响起事件响应区域，因为只有draw中处理了，measure和layout都没动</p>
<h3 id="Xml文件实现"><a href="#Xml文件实现" class="headerlink" title="Xml文件实现"></a>Xml文件实现</h3><p>通过xml来定义View动画涉及到一些公有的属性（在AndroidStudio上不能提示）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">android:duration     动画持续时间</span><br><span class="line">android:fillAfter    为true动画结束时，View将保持动画结束时的状态</span><br><span class="line">android:fillBefore   为true动画结束时，View将还原到开始开始时的状态</span><br><span class="line">android:repeatCount  动画重复执行的次数</span><br><span class="line">android:repeatMode   动画重复模式 ，重复播放时restart重头开始，reverse重复播放时倒叙回放，该属性需要和android:repeatCount一起使用</span><br><span class="line">android:repeatCount 默认是0，-1是无限循环</span><br><span class="line">android:interpolator 插值器，相当于变速器，改变动画的不同阶段的执行速度</span><br></pre></td></tr></table></figure>

<p>这些属性是从Animation中继承下来的，在<code>alpha</code>、<code>rotate</code>、<code>scale</code>、<code>translate</code>标签中都可以直接使用。<br>利用xml文件定义View动画需要在工程的res目录下创建anim文件夹，所有的xml定义的View动画都要放在anim目录下。其中标签   translate、scale、alpha、rotate，就是对应四种动画。set标签是动画集合，对应AnimationSet类，有多个动画构成。</p>
<p>其中android:duration是指动画时间，fillAfter为true是动画结束后保持，false会回到初始状态。interpolator是指动画的执行速度，默认是先加速后减速。其他标签及属性较简单可自行研究验证。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:duration</span>=<span class="string">&quot;5000&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:fillAfter</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:interpolator</span>=<span class="string">&quot;@android:anim/accelerate_decelerate_interpolator&quot;</span>&gt;</span> </span><br><span class="line">    <span class="comment">&lt;!--set里面的duration如果有值，会覆盖子标签的duration--&gt;</span></span><br><span class="line"></span><br><span class="line">    &lt;translate</span><br><span class="line">        android:duration=&quot;1000&quot;</span><br><span class="line">        android:fromXDelta=&quot;0&quot;</span><br><span class="line">        android:toXDelta=&quot;400&quot; /&gt;</span><br><span class="line">    &lt;scale</span><br><span class="line">        android:duration=&quot;2000&quot;</span><br><span class="line">        android:fromXScale=&quot;0.5&quot;</span><br><span class="line">        android:fromYScale=&quot;0.5&quot;</span><br><span class="line">        android:toXScale=&quot;1&quot;</span><br><span class="line">        android:toYScale=&quot;1&quot; /&gt;</span><br><span class="line">    &lt;alpha</span><br><span class="line">        android:duration=&quot;3000&quot;</span><br><span class="line">        android:fromAlpha=&quot;0.2&quot;</span><br><span class="line">        android:toAlpha=&quot;1&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;rotate</span><br><span class="line">        android:fromDegrees=&quot;0&quot;</span><br><span class="line">        android:toDegrees=&quot;90&quot; /&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>定义好动画后，使用也很简单，调用view的startAnimation方法即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//view动画使用，方式一：xml，建议使用。</span></span><br><span class="line">      Animation animation = AnimationUtils.loadAnimation(<span class="keyword">this</span>, R.anim.animation_test);</span><br><span class="line">      textView1.startAnimation(animation);</span><br></pre></td></tr></table></figure>

<p><code>rotate</code>、<code>scale</code>动画的<code>android:pivotX</code>和<code>android:pivotY</code>属性、<code>translate</code>动画的<code>android:toXDelta</code>和<code>android:toYDelta</code>属性的取值都可以是都可以数值、百分数、百分数<code>p</code>，比如：<code>50</code>、<code>50%</code>、<code>50%p</code>，他们取值的代表的意义各不相同：<br><code>50</code>表示以View左上角为原点沿坐标轴正方向(<code>x</code>轴向右，<code>y</code>轴向下)偏移<code>50px</code>的位置；<br><code>50%</code>表示以View左上角为原点沿坐标轴正方向(<code>x</code>轴向右，<code>y</code>轴向下)偏移View宽度或高度的50%处的位置；<br><code>50%p</code>表示以View左上角为原点沿坐标轴正方向(<code>x</code>轴向右，<code>y</code>轴向下)偏移父控件宽度或高度的50%处的位置（<code>p</code>表示相对于<code>ParentView</code>的位置）。</p>
<p>“50”：<img src="/2023/10/26/Animation/207f5681fbd42866692f260039ceaca8~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.awebp" alt="img" style="zoom: 50%;">  ； </p>
<p> “50%”<img src="/2023/10/26/Animation/8fafba2a2171db1efb63052a0370faed~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.awebp" alt="img" style="zoom:50%;">；</p>
<p>“50%p”<img src="/2023/10/26/Animation/613da23e462d2d04b9afa15d27029749~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.awebp" alt="img" style="zoom:50%;"></p>
<h3 id="代码动态实现"><a href="#代码动态实现" class="headerlink" title="代码动态实现"></a>代码动态实现</h3><p>在平常的业务逻辑中也可以直接用Java代码来实现Veiw动画，Android系统给我们提供了<code>AlphaAnimation</code>、<code>RotateAnimation</code>、<code>ScaleAnimation</code>、<code>TranslateAnimation</code>四个动画类分别来实现View的渐变、旋转、缩放、平移动画。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;view动画使用，方式二：new 动画对象</span><br><span class="line">        AnimationSet animationSet &#x3D; new AnimationSet(false);</span><br><span class="line">        animationSet.setDuration(3000);</span><br><span class="line">        animationSet.addAnimation(new TranslateAnimation(0, 100, 0, 0));</span><br><span class="line">        animationSet.addAnimation(new ScaleAnimation(0.1f, 1f, 0.1f, 1f));</span><br><span class="line">        animationSet.setFillAfter(true);</span><br><span class="line">        textView2.startAnimation(animationSet);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;view动画使用，方式二：new 动画对象,使用setAnimation</span><br><span class="line">        AnimationSet animationSet2 &#x3D; new AnimationSet(false);</span><br><span class="line">        animationSet2.setDuration(3000);</span><br><span class="line">        animationSet2.addAnimation(new TranslateAnimation(0, 100, 0, 0));</span><br><span class="line">        animationSet2.addAnimation(new ScaleAnimation(0.1f, 1f, 0.1f, 1f));</span><br><span class="line">        animationSet2.setFillAfter(true);</span><br><span class="line">        animationSet2.setAnimationListener(new Animation.AnimationListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onAnimationStart(Animation animation) &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            @Override</span><br><span class="line">            public void onAnimationEnd(Animation animation) &#123;</span><br><span class="line">                MyToast.showMsg(AnimationTestActivity.this, &quot;View动画：代码 set：View动画结束~&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">            @Override</span><br><span class="line">            public void onAnimationRepeat(Animation animation) &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        textView3.setAnimation(animationSet2);</span><br></pre></td></tr></table></figure>

<p>注意点：</p>
<ol>
<li>startAnimation方法是立刻播放动画；setAnimation是设置要播放的下一个动画。</li>
<li>setAnimationListener可以监听动画的开始、结束、重复。</li>
</ol>
<h3 id="自定义动画"><a href="#自定义动画" class="headerlink" title="自定义动画"></a>自定义动画</h3><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844904105589080078#heading-3">[3D旋转动画]</a></p>
<p>Like:ProgressBarAnimation</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProgressBarAnimation</span></span>(<span class="keyword">private</span> <span class="keyword">val</span> progressBar: ProgressBar, <span class="keyword">private</span> <span class="keyword">val</span> from: <span class="built_in">Int</span>, <span class="keyword">private</span> <span class="keyword">val</span> to: <span class="built_in">Int</span>) :</span><br><span class="line">    Animation() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">applyTransformation</span><span class="params">(interpolatedTime: <span class="type">Float</span>, t: <span class="type">Transformation</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.applyTransformation(interpolatedTime, t)</span><br><span class="line">        <span class="keyword">val</span> value = from + (to - from) * interpolatedTime</span><br><span class="line">        progressBar.progress = value.toInt()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="布局动画"><a href="#布局动画" class="headerlink" title="布局动画"></a>布局动画</h3><h4 id="LayoutTransition"><a href="#LayoutTransition" class="headerlink" title="LayoutTransition"></a>LayoutTransition</h4><p>使用LayoutAnimation给ViewGroup指定child的出场动画，方法如下：</p>
<p>1.先用xml定义标签LayoutAnimation：</p>
<ul>
<li>android:animation设置child的出场动画</li>
<li>android:animationOrder设置child的出场顺序，normal就是顺序</li>
<li>delay是指：每个child延迟（在android:animation中指定的动画时间）0.8倍后播放动画。如果android:animation中的动画时间是100ms，那么每个child都会延迟800ms后播放动画。 如果不设置delay，那么所有child同时执行动画。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;layoutAnimation xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class="line">    android:animation&#x3D;&quot;@anim&#x2F;enter_from_left_for_child_of_group&quot;</span><br><span class="line">    android:animationOrder&#x3D;&quot;normal&quot;</span><br><span class="line">    android:delay&#x3D;&quot;0.8&quot;&gt;</span><br><span class="line">&lt;&#x2F;layoutAnimation&gt;</span><br><span class="line">R.anim.enter_from_left_for_child_of_group</span><br><span class="line"></span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;set xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;&gt;</span><br><span class="line">    &lt;translate</span><br><span class="line">        android:duration&#x3D;&quot;1000&quot;</span><br><span class="line">        android:fromXDelta&#x3D;&quot;-100%p&quot;</span><br><span class="line">        android:toXDelta&#x3D;&quot;0&quot;&#x2F;&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;set&gt;</span><br></pre></td></tr></table></figure>

<p>2.把LayoutAnimation设置给ViewGroup</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;LinearLayout</span><br><span class="line">    android:id=&quot;@+id/ll_layout_animation&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">    android:orientation=&quot;horizontal&quot;</span><br><span class="line">    android:layoutAnimation=&quot;@anim/layout_animation&quot;&gt;</span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:layout_width=&quot;50dp&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:textColor=&quot;#ff0000&quot;</span><br><span class="line">        android:text=&quot;呵呵呵&quot;/&gt;</span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:layout_width=&quot;60dp&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:textColor=&quot;#ff0000&quot;</span><br><span class="line">        android:text=&quot;qq&quot;</span><br><span class="line">        android:background=&quot;@color/colorPrimary&quot;/&gt;</span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:layout_width=&quot;30dp&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:textColor=&quot;#ff0000&quot;</span><br><span class="line">        android:text=&quot;啊啊&quot;/&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>除了xml，当然也可以使用LayoutAnimationController 指定：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//代码设置LayoutAnimation，实现ViewGroup的child的出场动画</span></span><br><span class="line">Animation enterAnim = AnimationUtils.loadAnimation(<span class="keyword">this</span>, R.anim.enter_from_left_for_child_of_group);</span><br><span class="line">LayoutAnimationController controller = <span class="keyword">new</span> LayoutAnimationController(enterAnim);</span><br><span class="line">controller.setDelay(<span class="number">0.8f</span>);</span><br><span class="line">controller.setOrder(LayoutAnimationController.ORDER_NORMAL);</span><br><span class="line">llLayoutAnimation.setLayoutAnimation(controller);</span><br></pre></td></tr></table></figure>



<h4 id="animateLayoutChanges用处及原理"><a href="#animateLayoutChanges用处及原理" class="headerlink" title="animateLayoutChanges用处及原理"></a>animateLayoutChanges用处及原理</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android:animateLayoutChanges=&quot;true&quot;</span><br></pre></td></tr></table></figure>

<p><strong>animateLayoutChanges的实际实现就是LayoutTransition，</strong></p>
<p>android.view.ViewGroup.java</p>
<p><img src="/2023/10/26/Animation/image-20231026114011752.png" alt="image-20231026114011752"></p>
<h3 id="Dialog-Activity转场动画"><a href="#Dialog-Activity转场动画" class="headerlink" title="Dialog/Activity转场动画"></a>Dialog/Activity转场动画</h3><h4 id="Activity转场"><a href="#Activity转场" class="headerlink" title="Activity转场"></a>Activity转场</h4><p>overridePendingTransition</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">class XXActivity : Activity() &#123;</span><br><span class="line">	override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class="line">      super.onCreate(savedInstanceState)</span><br><span class="line">      setContentView(R.layout.activity_checkout_rec)</span><br><span class="line">      overridePendingTransition(</span><br><span class="line">          R.anim.slide_in_down, R.anim.slide_in_down</span><br><span class="line">      )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;set</span><br><span class="line">  xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">  android:interpolator=&quot;@android:anim/decelerate_interpolator&quot; &gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">translate</span> <span class="attr">android:duration</span>=<span class="string">&quot;200&quot;</span> <span class="attr">android:fromYDelta</span>=<span class="string">&quot;100%p&quot;</span> <span class="attr">android:toYDelta</span>=<span class="string">&quot;0%p&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;set</span><br><span class="line">  xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">  android:interpolator=&quot;@android:anim/decelerate_interpolator&quot; &gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">translate</span> <span class="attr">android:duration</span>=<span class="string">&quot;200&quot;</span> <span class="attr">android:fromYDelta</span>=<span class="string">&quot;0%p&quot;</span> <span class="attr">android:toYDelta</span>=<span class="string">&quot;100%p&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="Dialog转场"><a href="#Dialog转场" class="headerlink" title="Dialog转场"></a>Dialog转场</h4><p>Window?.setWindowAnimatinos()</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XXDialog</span></span>(context: Context, <span class="keyword">val</span> anim: PointBean.PointAnimation) :Dialog(context) &#123;</span><br><span class="line">  <span class="keyword">init</span> &#123;</span><br><span class="line">    setContentView(R.layout.threshold_dialog)</span><br><span class="line">    setCanceledOnTouchOutside(<span class="literal">true</span>)</span><br><span class="line">    window?.setGravity(Gravity.CENTER)</span><br><span class="line">    window?.setLayout(MATCH_PARENT, AndroidUtil.getScreenWidth(context))</span><br><span class="line">    window?.setBackgroundDrawable(ColorDrawable(Color.TRANSPARENT));</span><br><span class="line">    window?.setWindowAnimations(R.style.XXDialogAnim)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">&quot;XXDialogAnim&quot;</span> <span class="attr">mce_bogus</span>=<span class="string">&quot;1&quot;</span> <span class="attr">parent</span>=<span class="string">&quot;android:Animation&quot;</span>&gt;</span></span><br><span class="line"><span class="xml">     <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:windowEnterAnimation&quot;</span>&gt;</span>@anim/cart_threshold_dialog_enter_anim<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">     <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:windowExitAnimation&quot;</span>&gt;</span>@anim/cart_threshold_dialog_exit_anim<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>







<h2 id="属性动画"><a href="#属性动画" class="headerlink" title="属性动画"></a>属性动画</h2><p>属性动画本质上是 使用反射调用对象的setXX()、getXX()方法，根据插值器的值变化曲线修改对象属性，所以是视图实实在在的位置、尺寸等属性发生变化并会触发measure、layout，因此点击区域也就发生变化。</p>
<p>属性动画可对任意对象做动画，不仅仅是View。默认动画时间是300ms，10ms/帧。具体理解就是：<strong>可在给定的时间间隔内 实现 对象的某属性值 从 value1 到 value2的改变。</strong></p>
<p>使用很简单，可以直接<strong>代码实现</strong>（推荐），也可xml实现，举例如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//属性动画使用，方式一：代码，建议使用。 横移</span></span><br><span class="line">      ObjectAnimator translationX = ObjectAnimator</span><br><span class="line">              .ofFloat(textView6, <span class="string">&quot;translationX&quot;</span>, <span class="number">0</span>, <span class="number">200</span>)</span><br><span class="line">              .setDuration(<span class="number">1000</span>);</span><br><span class="line">      translationX.setInterpolator(<span class="keyword">new</span> LinearInterpolator());</span><br><span class="line">      setAnimatorListener(translationX);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//属性动画使用，方式二：xml。   竖移</span></span><br><span class="line">      Animator animatorUpAndDown = AnimatorInflater.loadAnimator(<span class="keyword">this</span>, R.animator.animator_test);</span><br><span class="line">      animatorUpAndDown.setTarget(textView6);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//文字颜色变化</span></span><br><span class="line">      ObjectAnimator textColor = ObjectAnimator</span><br><span class="line">              .ofInt(textView6, <span class="string">&quot;textColor&quot;</span>, <span class="number">0xffff0000</span>, <span class="number">0xff00ffff</span>)</span><br><span class="line">              .setDuration(<span class="number">1000</span>);</span><br><span class="line">      textColor.setRepeatCount(ValueAnimator.INFINITE);</span><br><span class="line">      textColor.setRepeatMode(ValueAnimator.REVERSE);</span><br><span class="line">      <span class="comment">//注意，这里如果不设置 那么颜色就是跳跃的，设置ArgbEvaluator 就是连续过度的颜色变化</span></span><br><span class="line">      textColor.setEvaluator(<span class="keyword">new</span> ArgbEvaluator());</span><br><span class="line"></span><br><span class="line">      <span class="comment">//animatorSet</span></span><br><span class="line">      mAnimatorSet = <span class="keyword">new</span> AnimatorSet();</span><br><span class="line">      mAnimatorSet</span><br><span class="line">              .play(animatorUpAndDown)</span><br><span class="line">              .with(textColor)</span><br><span class="line">              .after(translationX);</span><br><span class="line"></span><br><span class="line">      mAnimatorSet.start();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 设置属性动画的监听</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> translationX</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setAnimatorListener</span><span class="params">(ObjectAnimator translationX)</span> </span>&#123;</span><br><span class="line">      translationX.addUpdateListener(<span class="keyword">new</span> ValueAnimator.AnimatorUpdateListener() &#123;</span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationUpdate</span><span class="params">(ValueAnimator animation)</span> </span>&#123;</span><br><span class="line">              <span class="comment">//每播放一帧，都会调用</span></span><br><span class="line">          &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.KITKAT) &#123;</span><br><span class="line">          translationX.addPauseListener(<span class="keyword">new</span> AnimatorListenerAdapter() &#123;</span><br><span class="line">              <span class="meta">@Override</span></span><br><span class="line">              <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationResume</span><span class="params">(Animator animation)</span> </span>&#123;</span><br><span class="line">                  <span class="keyword">super</span>.onAnimationResume(animation);</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      translationX.addListener(<span class="keyword">new</span> AnimatorListenerAdapter() &#123;</span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationEnd</span><span class="params">(Animator animation)</span> </span>&#123;</span><br><span class="line">              <span class="keyword">super</span>.onAnimationEnd(animation);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>R.animator.animator_test，是放在res/animator中。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="comment">&lt;!--属性动画test,一般建议采用代码实现，不用xml--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:ordering</span>=<span class="string">&quot;sequentially&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--repeatCount：默认是0，-1是无限循环--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--repeatMode：重复模式：restart-从头来一遍、reverse-反向来一遍--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--valueType：指定propertyName的类型可选intType、floatType--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--android:pathData=&quot;&quot;</span></span><br><span class="line"><span class="comment">        android:propertyXName=&quot;&quot;</span></span><br><span class="line"><span class="comment">        android:propertyYName=&quot;&quot;--&gt;</span></span><br><span class="line">    &lt;objectAnimator</span><br><span class="line">        android:propertyName=&quot;translationY&quot;</span><br><span class="line">        android:duration=&quot;1000&quot;</span><br><span class="line">        android:valueFrom=&quot;0&quot;</span><br><span class="line">        android:valueTo=&quot;120&quot;</span><br><span class="line">        android:startOffset=&quot;0&quot;</span><br><span class="line">        android:repeatCount=&quot;0&quot;</span><br><span class="line">        android:repeatMode=&quot;reverse&quot;</span><br><span class="line">        android:valueType=&quot;floatType&quot;</span><br><span class="line">        android:interpolator=&quot;@android:interpolator/accelerate_decelerate&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--animator对用vueAnimator，比objectAnimator少了propertyName--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;animator--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--android:duration=&quot;2000&quot;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--android:valueFrom=&quot;&quot;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--android:valueTo=&quot;&quot;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--android:startOffset=&quot;&quot;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--android:repeatCount=&quot;&quot;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--android:repeatMode=&quot;&quot;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--android:valueType=&quot;&quot;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--android:interpolator=&quot;&quot;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--android:pathData=&quot;&quot;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--android:propertyXName=&quot;&quot;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--android:propertyYName=&quot;&quot;/&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>translationX是实现横移，animatorUpAndDown是实现竖移、textColor是实现文字颜色变化。其中animatorUpAndDown是使用xml定义，标签含义也很好理解。 最后使用AnimatorSet的play、with、after 实现 先横移，然后 竖移和颜色变化 同时的动画集合效果。</p>
<p><strong>注意点</strong>：</p>
<ol>
<li><strong>关于View动画和属性动画的平移</strong>，<strong>属性动画改变属性值setTranslationX 的视图效果像view动画的平移一样，都是view实际的layout位置没变，只改变了视图位置；不同点是属性动画 给触摸点生效区域增加了位移（而view动画仅改变了视图位置）。</strong></li>
<li><strong>插值器</strong>：Interpolator，根据 时间流逝的百分比，计算当前属性值改变的百分比。    例如duration是1000，start后过了200，那么时间百分比是0.2，那么如果差值器是LinearInterpolator线性差值器，那么属性值改变的百分比也是0.2</li>
<li><strong>估值器</strong>：Evaluator，就是根据 差值器获取的 属性值百分比，计算改变后的属性值。  ofInt、onFloat内部会自动设置IntEvaluator、FloatEvaluator。如果使用ofInt且是颜色相关的属性，就要设置ArgbEvaluator。 上面例子中 文字颜色变化动画 设置了ArgbEvaluator：textColor.setEvaluator(new ArgbEvaluator())。</li>
<li><strong>动画监听</strong>：主要是两个监听接口，AnimatorUpdateListener、AnimatorListenerAdapter。AnimatorUpdateListener的回调方法在每帧更新时都会调用一次；AnimatorListenerAdapter可以监听开始、结束、暂停、继续、重复、取消，重写你要关注的方法即可。</li>
</ol>
<h3 id="对任意属性做动画"><a href="#对任意属性做动画" class="headerlink" title="对任意属性做动画"></a>对任意属性做动画</h3><p>一个问题，针对下面的Button，如何实现 的宽度逐渐拉长的动画，即文字不变，仅拉长背景宽度？</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;Button</span><br><span class="line">    android:id=&quot;@+id/button_animator_test&quot;</span><br><span class="line">    android:layout_width=&quot;180dp&quot;</span><br><span class="line">    android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">    android:text=&quot;任意属性动画-宽度拉长&quot;/&gt;</span><br></pre></td></tr></table></figure>

<p>首先，View动画的ScaleAnimation是无法实现的，因为view的scale是把view的视图放大，这样文字也会拉长变形。那么属性动画呢？试试~</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ObjectAnimator width1 = ObjectAnimator.ofInt(button, &quot;width&quot;, 1000);</span><br><span class="line">width1.setDuration(2000);</span><br><span class="line">width1.start();</span><br></pre></td></tr></table></figure>

<p>但是发现，没有效果！这是为啥呢？解释如下.</p>
<p><strong>对object 的任意属性做动画 要求两个条件：</strong></p>
<ol>
<li>object有 对应属性 的set方法，动画中没设置初始值 还要有get方法，系统要去取初始值（不满足则会crash）。</li>
<li>set方法要对object有所改变，如UI的变化。不满足则会没有动画效果</li>
</ol>
<p>上面Button没有动画效果，就是没有满足第二条。看下Button的setWidth方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setWidth</span><span class="params">(<span class="keyword">int</span> pixels)</span> </span>&#123;</span><br><span class="line">    mMaxWidth = mMinWidth = pixels;</span><br><span class="line">    mMaxWidthMode = mMinWidthMode = PIXELS;</span><br><span class="line">    requestLayout();</span><br><span class="line">    invalidate();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实际就是TextView的setWidth方法，看到设置进去的值仅影响了宽度最大值和最小值。按照官方注释和实测，发现只有当Button/TextView在xml中设置android:layout_width为”wrap_content”时，才会setWidth改变宽度；而当Button/TextView在xml中设置android:layout_width为固定dp值时，setWidth无效。 而我们上面给出的Button xml中确实是固定值180dp，所以是属性”width”的setWidth是无效的，即不满足第二条要求，就没有动画效果了。（当修改Button xml中设置android:layout_width为”wrap_content”时，上面执行的属性动画是生效的。）</p>
<p>那么，当不满足条件时，如何解决此问题呢？ 有如下处理方法：</p>
<ol>
<li>给object添加set、get方法，如果有权限。（一般不行，如TextView是SDK里面的不能直接改）</li>
<li><strong>给Object包装一层，在包装类中提供set、get方法。</strong></li>
<li><strong>使用ValueAnimator，监听Value变化过程，自己实现属性的改变。</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">testAnimatorAboutButtonWidth</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//Button width 属性动画：如果xml中宽度是wrap_content，那么动画有效。</span></span><br><span class="line">        <span class="comment">// 如果设置button确切的dp值，那么无效，因为对应属性&quot;width&quot;的setWidth()方法就是 在wrap_content是才有效。</span></span><br><span class="line">        ObjectAnimator width1 = ObjectAnimator.ofInt(button, <span class="string">&quot;width&quot;</span>, <span class="number">1000</span>);</span><br><span class="line">        width1.setDuration(<span class="number">2000</span>);</span><br><span class="line"><span class="comment">//        width1.start();</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//那么，想要在button原本有确切dp值时，要能对width动画，怎么做呢？</span></span><br><span class="line">        <span class="comment">//方法一，包一层，然后用layoutParams</span></span><br><span class="line">        ViewWrapper wrapper = <span class="keyword">new</span> ViewWrapper(button);</span><br><span class="line">        ObjectAnimator width2 = ObjectAnimator.ofInt(wrapper, <span class="string">&quot;width&quot;</span>, <span class="number">1000</span>);</span><br><span class="line">        width2.setDuration(<span class="number">2000</span>);</span><br><span class="line"><span class="comment">//        width2.start();</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//方法二，使用ValueAnimator，每一帧自己显示宽度的变化</span></span><br><span class="line">        ValueAnimator valueAnimator = ValueAnimator.ofInt(button.getLayoutParams().width, <span class="number">1000</span>);</span><br><span class="line">        valueAnimator.addUpdateListener(<span class="keyword">new</span> ValueAnimator.AnimatorUpdateListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationUpdate</span><span class="params">(ValueAnimator animation)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">int</span> animatedValue = (Integer) animation.getAnimatedValue();</span><br><span class="line">                Log.i(<span class="string">&quot;hfy&quot;</span>, <span class="string">&quot;onAnimationUpdate: animatedValue=&quot;</span> + animatedValue);</span><br><span class="line"></span><br><span class="line"><span class="comment">//                IntEvaluator intEvaluator = new IntEvaluator();</span></span><br><span class="line"><span class="comment">////                获取属性值改变比例、计算属性值</span></span><br><span class="line"><span class="comment">//                float animatedFraction = animation.getAnimatedFraction();</span></span><br><span class="line"><span class="comment">//                Integer evaluate = intEvaluator.evaluate(animatedFraction, 300, 600);</span></span><br><span class="line"><span class="comment">//                Log.i(&quot;hfy&quot;, &quot;onAnimationUpdate: evaluate=&quot;+evaluate);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (button != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    button.getLayoutParams().width = animatedValue;</span><br><span class="line">                    button.requestLayout();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        valueAnimator.setDuration(<span class="number">4000</span>).start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 包一层，提供对应属性的set、get方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewWrapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> View mView;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ViewWrapper</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">            mView = view;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getWidth</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> mView.getLayoutParams().width;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setWidth</span><span class="params">(<span class="keyword">int</span> width)</span> </span>&#123;</span><br><span class="line">            ViewGroup.LayoutParams layoutParams = mView.getLayoutParams();</span><br><span class="line">            layoutParams.width = width;</span><br><span class="line">            mView.setLayoutParams(layoutParams);</span><br><span class="line">            mView.requestLayout();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>







<h3 id="属性动画的原理"><a href="#属性动画的原理" class="headerlink" title="属性动画的原理"></a>属性动画的原理</h3><p>属性动画，要求对象有这个属性的set方法，执行时会根据传入的 属性初始值、最终值，在每帧更新时调用set方法设置当前时刻的 属性值。随着时间推移，set的属性值会接近最终值，从而达到动画效果。如果没传入初始值，那么对象还要有get方法，用于获取初始值。</p>
<p><strong>在获取初始值、set属性值时，都是使用  反射  的方式，进行 get、set方法的调用。</strong> 见PropertyValuesHolder的setupValue、setAnimatedValue方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setupValue</span><span class="params">(Object target, Keyframe kf)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mProperty != <span class="keyword">null</span>) &#123;</span><br><span class="line">        Object value = convertBack(mProperty.get(target));</span><br><span class="line">        kf.setValue(value);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (mGetter == <span class="keyword">null</span>) &#123;</span><br><span class="line">                Class targetClass = target.getClass();</span><br><span class="line">                setupGetter(targetClass);</span><br><span class="line">                <span class="keyword">if</span> (mGetter == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// Already logged the error - just return to avoid NPE</span></span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            Object value = convertBack(mGetter.invoke(target));</span><br><span class="line">            kf.setValue(value);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            Log.e(<span class="string">&quot;PropertyValuesHolder&quot;</span>, e.toString());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            Log.e(<span class="string">&quot;PropertyValuesHolder&quot;</span>, e.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setAnimatedValue</span><span class="params">(Object target)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mProperty != <span class="keyword">null</span>) &#123;</span><br><span class="line">        mProperty.set(target, getAnimatedValue());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (mSetter != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            mTmpValueArray[<span class="number">0</span>] = getAnimatedValue();</span><br><span class="line">            mSetter.invoke(target, mTmpValueArray);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            Log.e(<span class="string">&quot;PropertyValuesHolder&quot;</span>, e.toString());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            Log.e(<span class="string">&quot;PropertyValuesHolder&quot;</span>, e.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上效果图：</p>
<p><img src="/2023/10/26/Animation/17121317607bf110~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.awebp" alt="在这里插入图片描述"></p>
<h3 id="使用动画的注意事项"><a href="#使用动画的注意事项" class="headerlink" title="使用动画的注意事项"></a>使用动画的注意事项</h3><ol>
<li><p>使用帧动画，避免OOM。因为图片多。</p>
</li>
<li><p>属性动画 如果有循环动画，在页面退出时要及时停止，避免内存泄漏。</p>
</li>
<li><p>使用View动画后，调用setVisibility(View.GONE)失效时，使用view.clearAnimation()可解决。</p>
</li>
<li><p>属性动画，可能会由于View属性变化导致频繁触发重新measure layout，注意性能</p>
</li>
</ol>
</div><div class="article-licensing box"><div class="licensing-title"><p>Animation</p><p><a href="http://example.com/2023/10/26/Animation/">http://example.com/2023/10/26/Animation/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>white crow</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2023-10-26</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2024-04-17</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2023/12/20/ServiceManager/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">ServiceManager</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2023/10/10/Lifecycle/"><span class="level-item">Lifecycle</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#View动画"><span class="level-left"><span class="level-item">1</span><span class="level-item">View动画</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Xml文件实现"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">Xml文件实现</span></span></a></li><li><a class="level is-mobile" href="#代码动态实现"><span class="level-left"><span class="level-item">1.2</span><span class="level-item">代码动态实现</span></span></a></li><li><a class="level is-mobile" href="#自定义动画"><span class="level-left"><span class="level-item">1.3</span><span class="level-item">自定义动画</span></span></a></li><li><a class="level is-mobile" href="#布局动画"><span class="level-left"><span class="level-item">1.4</span><span class="level-item">布局动画</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#LayoutTransition"><span class="level-left"><span class="level-item">1.4.1</span><span class="level-item">LayoutTransition</span></span></a></li><li><a class="level is-mobile" href="#animateLayoutChanges用处及原理"><span class="level-left"><span class="level-item">1.4.2</span><span class="level-item">animateLayoutChanges用处及原理</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Dialog-Activity转场动画"><span class="level-left"><span class="level-item">1.5</span><span class="level-item">Dialog/Activity转场动画</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Activity转场"><span class="level-left"><span class="level-item">1.5.1</span><span class="level-item">Activity转场</span></span></a></li><li><a class="level is-mobile" href="#Dialog转场"><span class="level-left"><span class="level-item">1.5.2</span><span class="level-item">Dialog转场</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#属性动画"><span class="level-left"><span class="level-item">2</span><span class="level-item">属性动画</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#对任意属性做动画"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">对任意属性做动画</span></span></a></li><li><a class="level is-mobile" href="#属性动画的原理"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">属性动画的原理</span></span></a></li><li><a class="level is-mobile" href="#使用动画的注意事项"><span class="level-left"><span class="level-item">2.3</span><span class="level-item">使用动画的注意事项</span></span></a></li></ul></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/avatarPng.png" alt="White Crow"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">White Crow</p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">81</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">12</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">4</p></a></div></div></nav></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/avatarCircle.png" alt="Crow&#039;s Sky" height="28"></a><p class="is-size-7"><span>&copy; 2025 white crow</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://github.com/WhileCrow"><i class="fab fa-creative-commons-by"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>